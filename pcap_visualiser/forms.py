from django import forms
from .models import PcapFile
from crispy_forms.helper import FormHelper
from crispy_forms.layout import Layout, Submit
from scapy.all import *
from scapy.layers.http import *
from crispy_forms.bootstrap import InlineCheckboxes


# DNS, UDP, ARP, NTP, IP, TCP, Raw, HTTP, RIP, RTP = 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
PROTOCOL_CHOICES = (('DNS', 'DNS'), ('UDP', 'UDP'), ("ARP", 'ARP'), ('NTP', 'NTP'), ('IP', 'IP'), ('TCP', 'TCP'), ('Raw', 'Raw'), ('HTTP', 'HTTP'), ('RIP', 'RIP'), ('RTP', 'RTP'))
    
class PcapFileForm(forms.ModelForm):
    class Meta:
        model = PcapFile
        fields = '__all__'

    whitelist = forms.MultipleChoiceField(choices=PROTOCOL_CHOICES, widget=forms.CheckboxSelectMultiple, required=False)
    blacklist = forms.MultipleChoiceField(choices=PROTOCOL_CHOICES, widget=forms.CheckboxSelectMultiple, required=False)
    
    def __init__(self, *args, **kwargs):
        super(PcapFileForm, self).__init__(*args, **kwargs)
        self.helper = FormHelper()
        self.helper.form_show_labels = True
        self.helper.form_method = 'post'
        self.helper.form_action = 'upload'
        self.helper.add_input(Submit('submit', 'Submit'))
        self.helper.layout = Layout(
            'pcap_file',
            InlineCheckboxes('whitelist'),
            InlineCheckboxes('blacklist'),
            'layer',
            'layout',
            'shape',
            'nmax',
            'geo_database',
        )